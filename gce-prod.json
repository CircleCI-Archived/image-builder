{
    "builders" : [
        {
            "type": "googlecompute",
	    "account_file": "./prod-credentials.json",
            "project_id": "circleci-picard-mahmood",
            "source_image": "ubuntu-1604-xenial-v20170619a",
            "zone": "us-east1-c",
	    "image_name": "ubuntu-1604-docker-v17-06-0-ce-{{timestamp}}",
	    "ssh_username": "circleci",
            "disk_size": 20
        }
    ],
    "provisioners" : [
        {
            "type" : "shell",
            "inline" : [
                "sleep 30",
	        "mkdir -p /tmp/circleci-provisioner"
	    ]
        },
        {
            "type": "file",
            "source": "./",
            "destination": "/tmp/circleci-provisioner"
        },
        {
            "type" : "shell",
            "inline" : [
                "cd /tmp/circleci-provisioner && sudo su root -c './provision.sh' &&  echo done",

                "sudo apt-get purge sshguard unattended-upgrades",
                "sudo systemctl mask apt-daily.service",
                "sudo rm -rf /home/circleci/.ssh/authorized_keys /tmp/circleci-provisioner",
                "echo after done",
	        "exit 0"
	    ]
        }
    ]
}
